{% extends "layouts/auth_layout.html" %}

{% block title %}PofuAI | Şifremi Unuttum{% endblock %}

{% block marketing_title %}Endişelenmeyin{% endblock %}
{% block marketing_subtitle %}Şifrenizi kolayca sıfırlayabilirsiniz{% endblock %}

{% block auth_form %}
<!-- Header -->
<div class="auth-header mb-4">
    <div class="icon-wrapper mb-3">
        <div class="auth-icon">
            <i class="bi bi-key-fill"></i>
        </div>
    </div>
    <h1 class="auth-title">Şifrenizi mi Unuttunuz?</h1>
    <p class="auth-subtitle">
        E-posta adresinizi girin, size şifre sıfırlama bağlantısı gönderelim
    </p>
</div>

<!-- Success/Error Messages -->
{% if messages %}
<div class="alert-container mb-4">
    {% for message in messages %}
    <div class="alert alert-{{ message.type }} alert-dismissible fade show" role="alert">
        <i class="bi bi-{{ message.icon }}"></i>
        {{ message.text }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Forgot Password Form -->
<form class="auth-form" method="POST" action="/auth/forgot-password" id="forgotPasswordForm">
    <!-- Email Input -->
    <div class="form-group">
        <label for="email" class="form-label">Kayıtlı E-posta Adresiniz</label>
        <div class="input-group">
            <i class="bi bi-envelope input-icon-left"></i>
            <input 
                type="email" 
                class="form-control with-icon-left" 
                id="email" 
                name="email" 
                placeholder="ornek@email.com" 
                required
                autocomplete="email"
                autofocus
            >
        </div>
        <div class="form-text mt-2">
            <i class="bi bi-info-circle"></i>
            Hesabınıza kayıtlı e-posta adresini girin
        </div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
        <i class="bi bi-send"></i>
        Sıfırlama Bağlantısı Gönder
    </button>

    <!-- Back to Login -->
    <div class="text-center mt-4">
        <a href="/auth/login" class="auth-link">
            <i class="bi bi-arrow-left"></i>
            Giriş sayfasına dön
        </a>
    </div>
</form>

<!-- Help Section -->
<div class="help-section mt-5">
    <div class="help-card">
        <h5 class="help-title">
            <i class="bi bi-question-circle"></i>
            Yardıma mı ihtiyacınız var?
        </h5>
        <ul class="help-list">
            <li>E-posta adresinizi doğru yazdığınızdan emin olun</li>
            <li>Spam/Gereksiz klasörünüzü kontrol edin</li>
            <li>E-posta 5 dakika içinde gelmezse tekrar deneyin</li>
            <li>Hala sorun yaşıyorsanız <a href="/contact" class="auth-link">destek ekibimizle</a> iletişime geçin</li>
        </ul>
    </div>
</div>

<!-- Security Notice -->
<div class="security-notice mt-4">
    <div class="d-flex align-items-center gap-2">
        <i class="bi bi-shield-check text-success"></i>
        <small class="text-muted">
            Güvenliğiniz için şifre sıfırlama bağlantısı sadece 1 saat geçerlidir
        </small>
    </div>
</div>

<style>
.auth-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 36px;
    box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
}

.help-section {
    padding-top: 30px;
    border-top: 1px solid var(--gray-200);
}

.help-card {
    background: var(--gray-50);
    border-radius: 12px;
    padding: 20px;
}

.help-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.help-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.help-list li {
    padding: 8px 0;
    color: var(--gray-600);
    font-size: 14px;
    position: relative;
    padding-left: 20px;
}

.help-list li:before {
    content: "•";
    position: absolute;
    left: 0;
    color: var(--primary-color);
    font-weight: bold;
}

.form-text {
    display: flex;
    align-items: center;
    gap: 5px;
    color: var(--gray-500);
    font-size: 13px;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgotPasswordForm');
    const submitBtn = document.getElementById('submitBtn');
    const emailInput = document.getElementById('email');
    
    // Focus email input
    emailInput.focus();
    
    // Handle form submission
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = emailInput.value.trim();
        
        // Validate email
        if (!validateEmail(email)) {
            emailInput.classList.add('is-invalid');
            AuthModern.showToast('Lütfen geçerli bir e-posta adresi girin', 'error');
            return;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span class="spinner"></span> Gönderiliyor...';
        
        // Simulate API call
        setTimeout(() => {
            // Show success message
            AuthModern.showToast('Şifre sıfırlama bağlantısı e-posta adresinize gönderildi!', 'success');
            
            // Show additional info
            showSuccessState(email);
            
            // Reset button after delay
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }, 3000);
        }, 2000);
    });
    
    // Email validation
    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    
    // Show success state
    function showSuccessState(email) {
        // Create success message
        const successDiv = document.createElement('div');
        successDiv.className = 'success-state mt-4 animate__animated animate__fadeIn';
        successDiv.innerHTML = `
            <div class="success-card">
                <div class="success-icon">
                    <i class="bi bi-check-circle-fill text-success"></i>
                </div>
                <h5>E-posta Gönderildi!</h5>
                <p class="mb-2">Şifre sıfırlama bağlantısı <strong>${email}</strong> adresine gönderildi.</p>
                <p class="text-muted small">E-posta birkaç dakika içinde gelmezse spam klasörünüzü kontrol edin.</p>
                <div class="mt-3">
                    <button class="btn btn-secondary btn-sm" onclick="location.href='/auth/login'">
                        Giriş Sayfasına Dön
                    </button>
                </div>
            </div>
        `;
        
        // Replace form with success message
        form.style.display = 'none';
        form.parentElement.insertBefore(successDiv, form.nextSibling);
    }
    
    // Real-time email validation
    emailInput.addEventListener('input', function() {
        if (this.value && !validateEmail(this.value)) {
            this.classList.add('is-invalid');
        } else {
            this.classList.remove('is-invalid');
        }
    });
});
</script>

<style>
.success-card {
    background: linear-gradient(135deg, #f0fdf4, #dcfce7);
    border: 2px solid var(--success-color);
    border-radius: 12px;
    padding: 30px;
    text-align: center;
}

.success-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.success-card h5 {
    color: var(--gray-800);
    margin-bottom: 15px;
}

.success-card p {
    color: var(--gray-600);
}
</style>
{% endblock %} 